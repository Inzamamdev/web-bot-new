<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Redirecting to StackBlitz...</title>
    <script type="application/javascript" src="https://unpkg.com/@stackblitz/sdk/bundles/sdk.umd.js"></script>
</head>

<body>
    <h1>Redirecting to StackBlitz...</h1>
    <p>Please wait while we prepare your project. If you are not redirected, please check your browser settings.</p>

    {{ files_data|json_script:"files-data" }}

    <script type="text/javascript">
        // ðŸŒŸ The core logic to perform the redirect
        window.addEventListener('load', function () {


            const filesDataElement = document.getElementById('files-data');
            let filesData;

            try {
                // Use the double-parse trick you discovered
                const parsedString = JSON.parse(filesDataElement.textContent);
                filesData = JSON.parse(parsedString);
            } catch (error) {
                console.error('Failed to parse file data:', error);
                document.body.innerHTML = '<h1>Error</h1><p>Failed to load project data. Please try again.</p>';
                return;
            }


            const project = {
                files: filesData,
                title: 'Live Preview: {{ repo_name }}',
                description: 'Generated by Preview System',
                template: 'node',
                dependencies: {},
            };
            
            // ðŸŒŸ Use openProject to redirect the user
            StackBlitzSDK.openProject(project, {openFile: "index.html"});
        });
    </script>
</body>

</html>